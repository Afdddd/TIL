# 이벤트 소싱(Event Soursing)

### 이벤트 소싱이란?

어플리케이션의 상태를 저장하고 관리하는 방법 중 하나로, 상태 변화를 기록하는 대신 상태 변화(이벤트) 자체를 저장하는 패턴이다. 

예제를 보면 쉽게 이해될 것이다.

사용자가 온라인 쇼핑몰에서 장바구니에 상품을 추가하거나 삭제한다고 가정해 보자. 일반적인 CRUD 방식에서는, 상품이 추가되거나 삭제될 때마다 장바구니 테이블의 데이터를 **직접** 업데이트하여 현재 상태만을 저장한다.

그러나 **이벤트 소싱**에서는 장바구니의 상태를 직접 업데이트하지 않고, **발생한 이벤트(변경 사항)** 를 기록한다. 장바구니의 현재 상태는 발생한 이벤트들을 순차적으로  재생해 계산한다.

시나리오

1. 사용자 A가 상품 X를 장바구니에 추가함.
2. 사용자 A가 상품 Y를 장바구니에 추가함.
3. 사용자 A가 상품 X를 삭제함.
4. 사용자 A가 상품 Z를 추가함.

### CRUD 방식

- 각 이벤트(상품 추가, 삭제)마다 장바구니의 현재 상태를 **직접** 업데이트한다.
- 마지막 상태는 `상품 Y, Z`가 장바구니에 남아 있는 상태가 된다.

### **이벤트 소싱** 방식

- 상태를 바로 업데이트하는 대신, 각 이벤트를 기록한다.
    1. **이벤트 1**: "상품 X 추가됨"
    2. **이벤트 2**: "상품 Y 추가됨"
    3. **이벤트 3**: "상품 X 삭제됨"
    4. **이벤트 4**: "상품 Z 추가됨"
    

장바구니의 현재 상태가 궁금하다면, 이벤트들을 **재생**해서 계산한다.

1. 첫 번째 이벤트(상품 X 추가) → 장바구니에 상품 X가 있음.
2. 두 번째 이벤트(상품 Y 추가) → 장바구니에 상품 X, Y가 있음.
3. 세 번째 이벤트(상품 X 삭제) → 장바구니에 상품 Y만 남음.
4. 네 번째 이벤트(상품 Z 추가) → 장바구니에 상품 Y, Z가 있음.

최종 장바구니 상태는 `상품 Y, Z`