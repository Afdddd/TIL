# SSH

**SSH**(Secure Shell)은 네트워크 프로토콜로, 네트워크를 통해 원격 시스템에 안전하게 접속하고 제어할 수 있도록한다. SSH는 암호화된 통신 채널을 사용해 사용자와 원격 서버 간의 통신을 보호하며, 원격 시스템에 로그인하여 명령어를 실행하거나 파일을 전송하는 등 다양한 작업을 안전하게 수행할 수 있도록 해준다.

<br>

### **SSH가 하는 일**

1. **원격 로그인**: 사용자가 네트워크를 통해 다른 컴퓨터에 원격으로 로그인할 수 있게 해준다.
2. **파일 전송**: SSH를 사용해 보안이 유지된 상태로 시스템 간 파일을 전송할 수 있습니다. 대표적으로 SCP(Secure Copy)나 SFTP(SSH File Transfer Protocol)를 사용합니다.

```
💡 SCP와 SFTP?

둘 다 SSH 프로토콜을 기반으로 하여 안전하게 파일을 전송하는 방법이다.

SCP : SSH를 사용하여 **파일을 안전하게 복사**하는 명령줄 도구, 기본적으로 로컬 시스템과 원격 시스템 간에 파일을 안전하게 복사하는 데 사용
SFTP : SSH 기반 파일 전송 프로토콜, SCP와 달리 SFTP는 원격 서버의 파일을 탐색하고 여러 작업을 수행할 수 있다.

```

3. **터널링/포트 포워딩**: SSH는 네트워크 트래픽을 암호화된 채널로 포워딩할 수 있으며, 이를 통해 방화벽을 우회하거나 특정 포트로의 접근을 제어할 수 있습니다.



```
💡터널링/포트 포워딩?

터널링은 포트 포워딩을 포함하는 더 넓은 개념으로, 한 프로토콜을 다른 프로토콜 안에 캡슐화하여 데이터를 전송하는 기술

포트 포워딩은 터널링의 한 형태로, 특정 네트워크 포트를 열고, 그 포트를 통해 들어오는 트래픽을 다른 시스템의 특정 포트로 전달하는 방식
```

<br><br>

### SSH 인증 방식

1. 비밀번호 인증

가장 기본적인 인증 방식으로, 서버에 접근하기 위해 사용자 이름과 비밀번호를 입력하는 방식

설정이 간단하고 추가 설정이 필요없다는 장점이 있다. 하지만 비밀번호는 유출될 위험이 있고, 보안이 필요한 경우 접합하지 않을 수 있다.

```bash
ssh 사용자명@서버주소
```

2. 공개 키 인증

비대칭 암호화 방식을 사용하는 인증 방법으로, 사용자 측에서 **개인 키**(private key)를 보유하고, 서버 측에 **공개 키**(public key)를 등록하는 방식

<br><br>

### 공개 키 등록 방법

<br>

**1. SSH 키 쌍 생성(클라이언트 측에서)**

클라이언트 측에서 SSH 키 쌍(공개 키와 개인 키)을 생성

```bash
ssh-keygen -t rsa -b 4096 -C "your_email@example.com"
```

- **`-t rsa`**: RSA 알고리즘을 사용.
- **`-b 4096`**: 4096비트 길이의 키를 생성하여 보안성을 높임
- **`-C "your_email@example.com"`**: 키를 식별할 수 있도록 주석을 추가 (보통 이메일 주소를 사용)

이 명령어를 실행하면, 키 쌍이 저장될 경로를 묻는다. 기본 경로는 `~/.ssh/id_rsa`이므로, 엔터를 눌러 기본 경로를 사용하거나 원하는 경로를 입력할 수 있다.

**개인 키**는 `id_rsa` 파일로, **공개 키**는 `id_rsa.pub` 파일로 저장된다.

<br><br>
**2. 공개키를 서버로 복사**

SSH 서버에 공개 키를 등록하려면 클라이언트의 공개 키를 서버에 복사해야 합니다. 이를 자동으로 처리하는 명령어는 `ssh-copy-id` 이다.

```bash
ssh-copy-id 사용자명@서버주소
```

- **`사용자명`**: 서버의 사용자 이름.
- **`서버주소`**: 서버의 IP 주소 또는 도메인 이름.

이 명령어는 클라이언트의 공개 키를 서버의 `~/.ssh/authorized_keys` 파일에 추가한다.
이후에는 비밀번호 대신 키 인증을 통해 서버에 접속할 수 있다.

<br>

**2-1. 공개키를 서버로 복사 (수동 방법)**
수동으로 복사하는 방법은 공개 키의 내용을 타겟 서버의 authorized_keys 파일에 추가하는 것이다.

공개 키 확인

```bash
cat ~/.ssh/authorized_keys
```

명령어로 공개키를 확인하고 복사한다.

다른 서버로 접속 (비밀번호를 사용하여 접속).

```bash
ssh user@<target-server-ip>
```

타겟 서버의 authorized_keys 파일에 복사해 놓은 공개 키 추가

```bash
echo "ssh-rsa..." >> ~/.ssh/authorized_keys
```

여기서 “ssh-rsa ...”가 공개 키 이다.

파일 권한 설정. 타겟 서버의 ~/.ssh/authorized_keys 파일과 .ssh 디렉터리의 권한을 설정해야 SSH 인증이 정상적으로 작동한다.

```bash
chmod 600 ~/.ssh/authorized_keys
chmod 700 ~/.ssh
```