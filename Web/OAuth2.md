# OAuth 2.0

<br>

**OAuth 2.0**은 사용자 또는 애플리케이션이 리소스에 접근할 수 있는 권한을 **안전하게 부여**하는 **오픈 표준 프로토콜**이다. 

<br>

> 💡 OAuth 2.0의 목적은 **사용자의 비밀번호나 민감한 정보를 노출하지 않고도** 다른 애플리케이션이 특정 리소스에 접근할 수 있도록 권한을 부여하는 것이다.


<br>

OAuth 2.0은 주로 제3의 애플리케이션이 사용자의 계정에 접근할 수 있도록 권한을 위임하는 방식으로 사용된다. 예를 들어, 웹 애플리케이션이 사용자의 Google, Facebook, GitHub 계정에 접근할 수 있도록 권한을 부여하는 경우에 사용한다.

OAuth 2.0에서는 **액세스 토큰(Access Token)** 과 같은 민감한 정보를 주고받기 때문에 HTTPS가 필수이다. 




```
💡 HTTPS란?
- HTTPS는 HTTP(HyperText Transfer Protocol)에 SSL/TLS 암호화를 추가한 프로토콜이다.
- 클라이언트(브라우저 등)와 서버 간의 통신이 암호화되며, 데이터를 중간에서 탈취하거나 조작하는 중간자 공격(Man-in-the-Middle Attack)을 방지할 수 있다.
```

<br><br>

## **OAuth 2.0의 동작 원리**

OAuth 2.0은 사용자가 제3의 애플리케이션(클라이언트)이 특정 리소스 서버에 접근할 수 있도록 **액세스 토큰**을 발급하는 구조로 이루어져 있다. 이 과정에서 민감한 정보를 주고받는 대신, **토큰 기반 인증**을 통해 권한을 위임받도록 한다.

<br>

- **리소스 소유자 (Resource Owner)**:
사용자를 의미한다. 예를 들어, Google 계정의 소유자인 사용자가 리소스 소유자이다.

<br>

- **클라이언트 (Client)**:
리소스 소유자의 데이터를 사용하기 위해 권한을 요청하는 제3의 애플리케이션이다. 예를 들어, 어떤 애플리케이션이 사용자의 Google 드라이브 파일에 접근하려고 할 때, 이 애플리케이션이 클라이언트가 된다.

<br>

- **인증 서버 (Authorization Server)**:
리소스 소유자의 권한을 확인하고, 클라이언트에게 **액세스 토큰**을 발급해주는 서버이다. 이 서버는 OAuth 2.0 흐름을 관리하는 핵심 서버이다. 예를 들어, 사용자가 Google 계정으로 로그인하려고 할 때, Google은 Authorization Server 역할을 하여 클라이언트 애플리케이션이 사용자를 대신해 리소스에 접근할 수 있도록 권한을 부여 한다.

<br>

- **리소스 서버 (Resource Server)**:
액세스 토큰을 받은 클라이언트가 실제로 접근하고자 하는 데이터를 가지고 있는 서버이다. 예를 들어 Google이 관리하는 **Google Drive, Gmail, YouTube**와 같은 서비스에서 사용자의 데이터(파일, 이메일, 비디오 등)에 접근할 수 있게 하는 서버가 바로 Resource Server이다.

<br>

- **액세스 토큰 (Access Token)**:
OAuth 2.0의 핵심으로, 리소스 서버에 접근할 수 있는 인증 권한을 클라이언트에게 부여하는 토큰이다. 클라이언트는 이 토큰을 사용해 리소스 서버에 데이터를 요청할 수 있다.

<br>

- **리프레시 토큰(Refresh Token):**
**엑세스 토큰**이 만료되었을 때, 사용자가 다시 로그인하지 않고 새로운 엑세스 토큰을 발급받을 수 있도록 하는 토큰이다.

<br><br>

## **OAuth 2.0 흐름**

1. **클라이언트가 권한 요청**: 클라이언트(애플리케이션)는 리소스 소유자(사용자)에게 리소스에 접근할 수 있도록 권한을 요청
2. **사용자가 권한 승인**: 리소스 소유자(사용자)는 권한 요청을 승인하면, 인증 서버는 클라이언트에게 **인증 코드** 또는 **액세스 토큰**을 발급
3. **클라이언트가 액세스 토큰 요청**: 클라이언트는 인증 코드를 받은 경우, 인증 서버에 다시 요청을 보내 **액세스 토큰**을 발급
4. **클라이언트가 리소스 서버에 접근**: 클라이언트는 발급받은 액세스 토큰을 사용하여 리소스 서버에 요청을 보내고, 리소스 서버는 이를 검증한 후 클라이언트에게 데이터를 제공

<br><br>

## **OAuth 2.0의 인증 방식 (Grant Types)**

OAuth 2.0에는 다양한 인증 방식이 있다.

<br>

### Authorization Code Grant

![image.png](/Web/img/OAuth2.png)

가장 일반적으로 사용되는 방식으로, 클라이언트가 액세스 토큰을 얻기 위해 먼저 **인증 코드**를 받는 방식이다. 보통 서버 측 애플리케이션에서 사용된다. 클라이언트는 인증 코드를 사용해 인증 서버에 액세스 토큰을 요청한다. 이 과정은 **클라이언트의 민감한 정보**가 노출되지 않도록 설계되었다.

1. **사용자 권한 요청 (Authorization Request)**
- 클라이언트 애플리케이션(예: 개발한 웹 애플리케이션)은 **사용자를 리소스 소유자**로부터 권한을 얻기 위해 **인증 서버**로 리다이렉트한다.
- 사용자는 인증 서버에서 로그인하고 애플리케이션이 자신의 리소스에 접근하는 것을 허용할 것인지 선택

<br>

2. **사용자 동의 및 Authorization Code 발급**
- 사용자가 로그인하고 애플리케이션의 접근을 승인하면, **인증 서버**는 **Authorization Code**를 발급하고 클라이언트 애플리케이션의 **리디렉션 URI**로 이를 전송한다.
- Authorization Code는 짧은 시간 동안만 유효하며, 이 코드를 사용해 **엑세스 토큰**을 요청할 수 있다.

<br>

3. **Authorization Code로 Access Token 요청**
- 클라이언트 애플리케이션은 Authorization Code를 받으면 **인증 서버**에 이 코드를 전송해 **엑세스 토큰**을 요청한다.

<br>

4. **Access Token 발급**
- 인증 서버는 Authorization Code가 유효하면 **엑세스 토큰**을 클라이언트 애플리케이션에 발급한다. 클라이언트 애플리케이션은 이 엑세스 토큰을 사용해 **리소스 서버**에 요청을 보내고 리소스에 접근할 수 있다.

<br>

5. **Access Token을 사용해 리소스 요청**
- 이제 클라이언트 애플리케이션은 발급받은 엑세스 토큰을 이용해 **리소스 서버**에 접근하여 사용자의 리소스에 요청을 보낼 수 있다.

<br>

### Implicit Grant

브라우저에서 실행되는 애플리케이션에서 주로 사용되는 방식으로, **액세스 토큰**을 직접 발급받는 방식.  보안상 권장되지 않는다.

<br>

### Resource Owner Password Credentials Grant

리소스 소유자의 **사용자 이름과 비밀번호**를 사용해 클라이언트가 직접 액세스 토큰을 발급받는 방식. 

<br>

### Client Credentials Grant
클라이언트가 **자체적으로 리소스 서버에 접근**할 때 사용되는 방식. 주로 서버 간 통신에서 사용되며, 사용자 인증 없이 클라이언트가 서버의 리소스에 접근해야 할 때 사용된다.

<br><br>

## **OAuth 2.0의 장점**

- **보안 강화**: 사용자 비밀번호를 제3의 애플리케이션과 직접 공유하지 않고, **액세스 토큰**을 통해 권한을 위임함으로써 보안 강화
- **확장성**: 다양한 서비스와 애플리케이션 간에 권한을 위임하고, 이를 확장성 있게 관리할 수 있다.

<br><br>

## **OAuth 2.0의 단점**

- **복잡성**: OAuth 2.0은 다양한 인증 방식을 제공하지만, 그로 인해 복잡성이 증가
- **보안 이슈**: 잘못된 구현이나 관리가 이루어지면 액세스 토큰이나 리프레시 토큰의 유출 등 보안 문제가 발생할 수 있다. 특히 **Implicit Grant**와 같은 방식은 보안상 취약점이 있다.